<!DOCTYPE html>
<!-- saved from url=(0045)file:///home/x-trim/Documents/DDX/sophia.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Diagnostics Lab | Sophia</title>
    <script src="./Digital Diagnostics Lab _ Sophia_files/saved_resource"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./Digital Diagnostics Lab _ Sophia_files/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* Main layout */
        .app-container {
            display: flex;
            height: 100vh;
            width: 100%;
        }
        
        /* Sidebar styles */
        #sidebar {
            width: 17%;
            background-image: url('./images/Sophia.png');
            background-size: cover;
            background-position: center;
            transition: width 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        #sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }
        
        .sidebar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2rem;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .company-name {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .sidebar-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem 0;
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .sidebar-subtitle {
            font-size: 1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .features-list li {
            padding: 0.75rem 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .features-list li i {
            margin-right: 1rem;
            color: #3B82F6;
        }
        
        .sidebar-footer {
            color: rgb(175, 172, 172);
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        /* Toggle button */
        .sidebar-toggle {
            position: absolute;
            top: 1rem;
            right: -2.5rem;
            width: 2.5rem;
            height: 2.5rem;
            background-color: #2563EB;
            color: white;
            border: none;
            border-radius: 0 0.5rem 0.5rem 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle:hover {
            background-color: #1D4ED8;
        }
        
        /* Chat container styles */
        footer{
            background-color: #0f0f0f !important;

        }
        .chat-container {
            background-color: rgb(2, 2, 2) !important;
        }
        #chat-container-wrapper {
            width: 85%;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
        }
        
        #chat-container-wrapper.expanded {
            width: 100%;
        }
        
        .chat-bubble-user {
            background-color: #3B82F6;
            color: white;
        }
        .chat-bubble-bot {
            background-color: #0f0f0f;
            color: #ffffff;
        }
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #575b63;
            border-radius: 3px;
        }
        .chat-container::-webkit-scrollbar-track {
            background-color: #F3F4F6;
        }
        .test-card-enter {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cart System Styles */
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            color: #4B5563;
        }
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #EF4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .cart-aside {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background-image: url('./images/Jade.jpeg');
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }
        .cart-aside::before {
            content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.897); /* 50% opacity black */
    z-index: 1;
        }
        .cart-aside > * {
            position: relative;
    z-index: 2;
        }
        .cart-aside.active {
            right: 0;
        }
        .cart-header {
            color: whitesmoke;
            padding: 1.5rem;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        .cart-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }
        .close-cart {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: #6B7280;
        }
        .cart-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .cart-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #9CA3AF;
        }
        .cart-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .cart-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid #F3F4F6;
        }
        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 1rem;
        }
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .item-details {
            flex: 1;
        }
        .item-name {
            color: whitesmoke;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .item-category {
            color: #6B7280;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .item-price {
            font-weight: 600;
            color: #00ffae;
        }
        .item-controls {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-end;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            overflow: hidden;
        }
        .quantity-btn {
            color: whitesmoke;
            background: none;
            border: none;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .quantity {
            color: whitesmoke;
            padding: 0 0.5rem;
            min-width: 30px;
            text-align: center;
        }
        .remove-btn {
            background: none;
            border: none;
            color: #EF4444;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .cart-footer {
            padding: 1.5rem;
            border-top: 1px solid #E5E7EB;
        }
        .cart-total {
            color: whitesmoke;
            display: flex;
            justify-content: space-between;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .checkout-btn {
            width: 100%;
            background-color: #059669;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .checkout-btn i {
            margin-right: 0.5rem;
        }
        .checkout-btn:hover {
            background-color: #047857;
        }
        .cart-notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10B981;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1002;
        }
        .cart-notification.show {
            opacity: 1;
        }
        .cart-notification i {
            margin-right: 0.5rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            #sidebar {
                width: 100%;
                height: 30vh;
            }
            
            #sidebar.collapsed {
                width: 100%;
                height: 0;
            }
            
            #chat-container-wrapper {
                width: 100%;
                height: 70vh;
            }
            
            #chat-container-wrapper.expanded {
                height: 100vh;
            }
            
            .sidebar-toggle {
                top: auto;
                bottom: -2.5rem;
                right: 1rem;
                border-radius: 0.5rem 0.5rem 0 0;
            }
            
            .cart-aside {
                width: 100%;
                right: -100%;
            }
        }
        .loader {
      transform: rotateZ(45deg);
      perspective: 1000px;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      color: rgb(255, 13, 0);
    }
    .loader:before,
    .loader:after {
      content: '';
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: inherit;
      height: inherit;
      border-radius: 50%;
      transform: rotateX(70deg);
      animation: 1s spin linear infinite;
    }
    .loader:after {
      color: rgb(0, 225, 255);
      transform: rotateY(70deg);
      animation-delay: .4s;
    }
    @keyframes spin {
      0%, 100% { box-shadow: .2em 0px 0 0px currentcolor; }
      12% { box-shadow: .2em .2em 0 0 currentcolor; }
      25% { box-shadow: 0 .2em 0 0px currentcolor; }
      37% { box-shadow: -.2em .2em 0 0 currentcolor; }
      50% { box-shadow: -.2em 0 0 0 currentcolor; }
      62% { box-shadow: -.2em -.2em 0 0 currentcolor; }
      75% { box-shadow: 0px -.2em 0 0 currentcolor; }
      87% { box-shadow: .2em -.2em 0 0 currentcolor; }
    }
.hidden {display: hidden;}
.suggestion {background-color: #fffdd0;}
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.right-4{right:1rem}.top-4{top:1rem}.z-50{z-index:50}.my-1{margin-top:0.25rem;margin-bottom:0.25rem}.mb-3{margin-bottom:0.75rem}.ml-3{margin-left:0.75rem}.mr-4{margin-right:1rem}.mb-4{margin-bottom:1rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.flex{display:flex}.hidden{display:none}.h-12{height:3rem}.h-6{height:1.5rem}.h-full{height:100%}.w-12{width:3rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-xs{max-width:20rem}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded-full{border-radius:9999px}.rounded-xl{border-radius:0.75rem}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.object-cover{object-fit:cover}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-500:hover{--tw-bg-opacity:1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-200:hover{--tw-bg-opacity:1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}.focus\:ring-offset-2:focus{--tw-ring-offset-width:2px}@media (min-width: 1024px){.lg\:max-w-md{max-width:28rem}}</style></head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-overlay">
                <div style="display: flex; justify-content: center;">
                <img src="./Digital Diagnostics Lab _ Sophia_files/XT_Logo_removebg.png" alt="" width="150">
                </div>
                <br><br><br><br><br><br><br><br>
                <div class="sidebar-content">
                    <h1 class="sidebar-title">Your Health, Our Priority</h1>
                    
                    <br><br>

                    <p class="sidebar-subtitle">Sophia AI Assistant is here to help you understand your symptoms and find the right tests</p>
                    
                    <br><br>

                    <ul class="features-list">
                        <li><i class="fas fa-check-circle"></i> AI-powered symptom analysis</li>
                        <li><i class="fas fa-check-circle"></i> Professional test recommendations</li>
                        <li><i class="fas fa-check-circle"></i> Transparent pricing</li>
                        <li><i class="fas fa-check-circle"></i> Fast results delivery</li>
                    </ul>
                </div>
                
                <div class="sidebar-footer">
                    <p>© 2025 X-Trim Research Ltd. All rights reserved.</p>
                </div>
            </div>
        </div>
        
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle">
            <i class="fas fa-chevron-left" id="toggle-icon"></i>
        </button>
        
        <!-- Chat Container -->
        <div id="chat-container-wrapper">
            <!-- Cart Icon -->
            <div class="fixed top-4 right-4 z-50">
                <div class="cart-icon" id="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cart-count">2</span>
                </div>
            </div>

            <!-- Chat Widget -->
            <div class="w-full h-full bg-white flex flex-col">
                <!-- Chatbot Interface -->
                <div class="w-full flex flex-col h-full">
                    <header class="bg-gray-800 text-white p-4 flex items-center justify-between shadow-md">
                        <div class="flex items-center">
    <div class="w-12 h-12 rounded-full overflow-hidden mr-4">
       <img src="./Digital Diagnostics Lab _ Sophia_files/Sophia.png" alt="Sophia" class="w-full h-full object-cover">
    </div>
    
    <div>
        <h1 class="text-xl font-bold">Sophia</h1>
        <p class="text-sm text-gray-300">Your Personal Health Guide</p>
    </div>
</div>
                        <div class="flex items-center space-x-4">
                            <div class="cart-icon hidden" id="cart-icon-header">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-count" id="cart-count-header">2</span>
                            </div>
                        </div>
                    </header>

                    <main id="chat-container" class="flex-1 p-6 overflow-y-auto chat-container bg-gray-50">
                        <!-- Chat messages will be appended here -->
                    <div class="flex mb-4 justify-start"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-bot">Hello! I'm Sophia, your personal health assistant. I can help you understand your symptoms and suggest relevant lab tests. What's your main symptom today?</div></div><div class="flex mb-4 justify-end"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-user">Fever</div></div><div class="flex mb-4 justify-start"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-bot">I see. A fever can be concerning. How long have you had the fever, and approximately how high is your temperature usually?</div></div><div class="flex mb-4 justify-end"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-user">Less than 3 days, low grade (below 101F)</div></div><div class="flex mb-4 justify-start"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-bot">Thank you for that information. Before I can suggest any specific tests, could you please tell me your age and gender?</div></div><div class="flex mb-4 justify-end"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-user">Age: 28, Gender: Female</div></div><div class="flex mb-4 justify-start"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-bot">Thank you. Since you are experiencing a low-grade fever for less than 3 days, are you also noticing any other symptoms like a sore throat, cough, body aches, or fatigue?</div></div><div class="flex mb-4 justify-end"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-user">Sore throat and cough</div></div><div class="flex mb-4 justify-start"><div class="rounded-xl py-2 px-4 max-w-xs lg:max-w-md chat-bubble-bot">Based on your symptoms (low-grade fever, sore throat, and cough) and your age and gender (28, Female), these tests could help identify the underlying cause of infection or inflammation.</div></div><div id="suggested-tests-container" class="mt-4 p-4 bg-gray rounded-lg border border-gray-200"><h3 class="font-bold text-lg mb-3 text-white">Suggested Tests</h3><div class="p-4 rounded-lg shadow-md border border-gray-200 test-card-enter mb-3 suggestion">
                    <h3 class="font-bold text-md text-gray-800">Erythrocyte Sedimentation Rate</h3>
                    <p class="text-sm text-gray-600 my-1">Measures how quickly red blood cells settle in a test tube to help detect inflammation in the body.</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-lg font-semibold text-blue-600">₦10,000</span>
                        <button class="add-to-cart-btn text-blue-700 px-4 py-1 rounded-md text-sm font-semibold transition bg-green-100 text-green-700" data-code="ESR" disabled="">Added!</button>
                    </div>
                </div><div class="p-4 rounded-lg shadow-md border border-gray-200 test-card-enter mb-3 suggestion">
                    <h3 class="font-bold text-md text-gray-800">Wound Swab Culture and Sensitivity</h3>
                    <p class="text-sm text-gray-600 my-1">Detects and identifies bacteria from wound infections and determines the most effective antibiotic treatment.</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-lg font-semibold text-blue-600">₦10,000</span>
                        <button class="add-to-cart-btn text-blue-700 px-4 py-1 rounded-md text-sm font-semibold transition bg-green-100 text-green-700" data-code="WOUND-SWAB-CS" disabled="">Added!</button>
                    </div>
                </div></div></main>

                    <footer class="p-4 bg-white border-t border-gray-200">
                        <div id="quick-replies" class="flex flex-wrap gap-2 mb-3"><button class="px-3 py-1 border border-blue-500 text-blue-500 rounded-full text-sm hover:bg-blue-500 hover:text-white transition">Start with these tests</button><button class="px-3 py-1 border border-blue-500 text-blue-500 rounded-full text-sm hover:bg-blue-500 hover:text-white transition">Tell me more about the tests</button><button class="px-3 py-1 border border-blue-500 text-blue-500 rounded-full text-sm hover:bg-blue-500 hover:text-white transition">I have additional symptoms</button><button class="px-3 py-1 border border-blue-500 text-blue-500 rounded-full text-sm hover:bg-blue-500 hover:text-white transition">No, I want to skip tests</button></div>
                        <div class="flex items-center keypad">
                            <input type="text" id="user-input" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="Type your symptoms...">
                            <button id="send-btn" class="ml-3 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition shadow-lg">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            </button>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-aside" id="cart-sidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart" id="close-cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-content" id="cart-content">
                            <div class="cart-item">
                                <div class="item-image">
                                    <img src="./Digital Diagnostics Lab _ Sophia_files/photo-1582719471384-894fbb16e074" alt="Erythrocyte Sedimentation Rate">
                                </div>
                                <div class="item-details">
                                    <div class="item-name">Erythrocyte Sedimentation Rate</div>
                                    <div class="item-category">Blood Test</div>
                                    <div class="item-price">₦10,000</div>
                                </div>
                                <div class="item-controls">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn decrease" data-id="ESR">-</button>
                                        <span class="quantity">1</span>
                                        <button class="quantity-btn increase" data-id="ESR">+</button>
                                    </div>
                                    <button class="remove-btn" data-id="ESR">Remove</button>
                                </div>
                            </div>
                        
                            <div class="cart-item">
                                <div class="item-image">
                                    <img src="./Digital Diagnostics Lab _ Sophia_files/photo-1628614538535-8a5b8d024d3f" alt="Wound Swab Culture and Sensitivity">
                                </div>
                                <div class="item-details">
                                    <div class="item-name">Wound Swab Culture and Sensitivity</div>
                                    <div class="item-category">Microbiology</div>
                                    <div class="item-price">₦10,000</div>
                                </div>
                                <div class="item-controls">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn decrease" data-id="WOUND-SWAB-CS">-</button>
                                        <span class="quantity">1</span>
                                        <button class="quantity-btn increase" data-id="WOUND-SWAB-CS">+</button>
                                    </div>
                                    <button class="remove-btn" data-id="WOUND-SWAB-CS">Remove</button>
                                </div>
                            </div>
                        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total-price">₦20,000</span>
            </div>
            <button class="checkout-btn" id="checkout-btn">
                <i class="fab fa-whatsapp"></i>
                Checkout via WhatsApp
            </button>
        </div>
    </div>

    <!-- Cart Notification -->
    <div class="cart-notification" id="cart-notification">
        <i class="fas fa-check"></i>
        <span>Test added to cart!</span>
    </div>

    <script>
        // Cart System Class
        class CartSystem {
            constructor() {
                this.cart = this.loadCart();
                this.updateCartUI();
            }

            loadCart() {
                try {
                    const cartData = sessionStorage.getItem('labCart');
                    return cartData ? JSON.parse(cartData) : {};
                } catch (error) {
                    console.error('Error loading cart from sessionStorage:', error);
                    return {};
                }
            }

            saveCart() {
                try {
                    sessionStorage.setItem('labCart', JSON.stringify(this.cart));
                } catch (error) {
                    console.error('Error saving cart to sessionStorage:', error);
                }
            }

            addItem(test) {
                // Check if item already exists in cart
                if (this.cart[test.id]) {
                    this.showNotification('Item already in cart!');
                    return false;
                }

                // Add item to cart
                this.cart[test.id] = {
                    ...test,
                    quantity: 1
                };

                this.saveCart();
                this.updateCartUI();
                this.showNotification('Test added to cart!');
                return true;
            }

            removeItem(testId) {
                if (this.cart[testId]) {
                    delete this.cart[testId];
                    this.saveCart();
                    this.updateCartUI();
                    this.showNotification('Item removed from cart');
                }
            }

            updateQuantity(testId, newQuantity) {
                if (this.cart[testId]) {
                    if (newQuantity <= 0) {
                        this.removeItem(testId);
                    } else {
                        this.cart[testId].quantity = newQuantity;
                        this.saveCart();
                        this.updateCartUI();
                    }
                }
            }

            getCartCount() {
                return Object.keys(this.cart).length;
            }

            getCartTotal() {
                return Object.values(this.cart).reduce((total, item) => {
                    return total + (item.price * item.quantity);
                }, 0);
            }

            updateCartUI() {
                // Update cart count
                const cartCount = this.getCartCount();
                const cartCountElement = document.getElementById('cart-count');
                const cartCountHeaderElement = document.getElementById('cart-count-header');
                
                if (cartCountElement) {
                    cartCountElement.textContent = cartCount;
                }
                if (cartCountHeaderElement) {
                    cartCountHeaderElement.textContent = cartCount;
                }

                // Update cart content
                this.updateCartContent();
            }

            updateCartContent() {
                const cartContent = document.getElementById('cart-content');
                if (!cartContent) return;

                if (this.getCartCount() === 0) {
                    cartContent.innerHTML = `
                        <div class="cart-empty">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Your cart is empty</p>
                        </div>
                    `;
                } else {
                    let itemsHTML = '';
                    Object.values(this.cart).forEach(item => {
                        itemsHTML += `
                            <div class="cart-item">
                                <div class="item-image">
                                    <img src="${item.image}" alt="${item.name}">
                                </div>
                                <div class="item-details">
                                    <div class="item-name">${item.name}</div>
                                    <div class="item-category">${item.category}</div>
                                    <div class="item-price">₦${item.price.toLocaleString()}</div>
                                </div>
                                <div class="item-controls">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                                        <span class="quantity">${item.quantity}</span>
                                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                                    </div>
                                    <button class="remove-btn" data-id="${item.id}">Remove</button>
                                </div>
                            </div>
                        `;
                    });
                    cartContent.innerHTML = itemsHTML;

                    // Add event listeners
                    cartContent.querySelectorAll('.decrease').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            const currentQuantity = this.cart[id].quantity;
                            this.updateQuantity(id, currentQuantity - 1);
                        });
                    });

                    cartContent.querySelectorAll('.increase').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            const currentQuantity = this.cart[id].quantity;
                            this.updateQuantity(id, currentQuantity + 1);
                        });
                    });

                    cartContent.querySelectorAll('.remove-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            this.removeItem(id);
                        });
                    });
                }

                // Update total price
                const totalPriceElement = document.getElementById('cart-total-price');
                if (totalPriceElement) {
                    totalPriceElement.textContent = `₦${this.getCartTotal().toLocaleString()}`;
                }
            }

            showNotification(message) {
                const notification = document.getElementById('cart-notification');
                if (notification) {
                    notification.querySelector('span').textContent = message;
                    notification.classList.add('show');
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 2000);
                }
            }

            clearCart() {
                this.cart = {};
                this.saveCart();
                this.updateCartUI();
            }

            // WhatsApp Integration
            checkout() {
                if (this.getCartCount() === 0) {
                    alert('Your cart is empty!');
                    return;
                }

                const message = this.formatWhatsAppMessage();
                const phoneNumber = '+2348120527885'; // Replace with your WhatsApp number
                
                // Detect device and create appropriate WhatsApp URL
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                const whatsappUrl = isMobile 
                    ? `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`
                    : `https://web.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`;

                // Open WhatsApp
                window.open(whatsappUrl, '_blank');
                
                // Optional: Clear cart after checkout
                // this.clearCart();
            }

            formatWhatsAppMessage() {
                const items = Object.values(this.cart);
                const itemsList = items.map(item => 
                    `• ${item.name} (${item.quantity} x ₦${item.price.toLocaleString()}) = ₦${(item.quantity * item.price).toLocaleString()}`
                ).join('\n');

                return `Hello! I would like to order the following lab tests:\n\n${itemsList}\n\nTotal: ₦${this.getCartTotal().toLocaleString()}\n\nPlease provide available time slots for sample collection.`;
            }
        }

        // Chatbot functionality
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const quickRepliesContainer = document.getElementById('quick-replies');
        
        // Sidebar toggle functionality
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const toggleIcon = document.getElementById('toggle-icon');
        const chatContainerWrapper = document.getElementById('chat-container-wrapper');
        
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            chatContainerWrapper.classList.toggle('expanded');
            
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.classList.remove('fa-chevron-left');
                toggleIcon.classList.add('fa-chevron-right');
            } else {
                toggleIcon.classList.remove('fa-chevron-right');
                toggleIcon.classList.add('fa-chevron-left');
            }
        });

        // Cart elements
        const cartIcon = document.getElementById('cart-icon');
        const cartIconHeader = document.getElementById('cart-icon-header');
        const cartSidebar = document.getElementById('cart-sidebar');
        const closeCartBtn = document.getElementById('close-cart');
        const checkoutBtn = document.getElementById('checkout-btn');

        // Cart toggle functionality
        cartIcon.addEventListener('click', () => {
            cartSidebar.classList.add('active');
        });
        cartIconHeader.addEventListener('click', () => {
            cartSidebar.classList.add('active');
        });
        closeCartBtn.addEventListener('click', () => {
            cartSidebar.classList.remove('active');
        });
        checkoutBtn.addEventListener('click', () => {
            window.labCart.checkout();
        });

        // --- GEMINI API INTEGRATION ---
        const GEMINI_API_KEY = "AIzaSyDsaKKeDy2yDrFMpWsPvwq989ugr9JYvMk"; // Replace with your actual API key
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`;

        let conversationHistory = [];

        // Updated test database with Naira prices
        const testDatabase = {
            'HGB': { 
                id: 'HGB',
                name: 'Haemoglobin Estimation', 
                price: 3000, 
                description: 'Measures the amount of haemoglobin in your blood to check for anaemia or other blood conditions.',
                category: 'Blood Test',
                image: './images/Jade.jpeg'
            },
            'PCV': { 
                id: 'PCV',
                name: 'Packed Cell Volume', 
                price: 2500, 
                description: 'Determines the percentage of red blood cells in your blood.',
                category: 'Blood Test',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'MPT': { 
                id: 'MPT',
                name: 'Malaria Parasite Test', 
                price: 4000, 
                description: 'Detects the presence of malaria parasites in your blood.',
                category: 'Parasitology',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'WAT': { 
                id: 'WAT',
                name: 'Widal Agglutination Test', 
                price: 5000, 
                description: 'Used to diagnose typhoid fever by detecting Salmonella antibodies in blood.',
                category: 'Serology',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'UC': { 
                id: 'UC',
                name: 'Urine Chemistry', 
                price: 4000, 
                description: 'Analyzes the chemical composition of urine to detect abnormalities.',
                category: 'Urine Test',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'CAURM': { 
                id: 'CAURM',
                name: 'Computer Assisted Urine Microscopy', 
                price: 2500, 
                description: 'Provides detailed microscopic analysis of urine using automated systems.',
                category: 'Urine Test',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'ERYBAS': { 
                id: 'ERYBAS',
                name: 'Erythrocyte Basic', 
                price: 8500, 
                description: 'Examines red blood cell structure and count for haematological disorders.',
                category: 'Blood Test',
                image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
            },
            'FBC': { 
        id: 'FBC',
        name: 'Full Blood Count', 
        price: 6000, 
        description: 'Evaluates overall health by measuring various components of blood.',
        category: 'Blood Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'CBS': { 
        id: 'CBS',
        name: 'Complete Blood Study', 
        price: 20500, 
        description: 'A detailed evaluation of all blood components for comprehensive diagnosis.',
        category: 'Blood Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'SA': { 
        id: 'SA',
        name: 'Stool Analysis', 
        price: 4000, 
        description: 'Examines stool samples for infections, parasites, and digestive issues.',
        category: 'Parasitology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'SSN': { 
        id: 'SSN',
        name: 'Skin Snip', 
        price: 6000, 
        description: 'Tests for microfilariae and other skin-borne infections using small skin samples.',
        category: 'Parasitology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'SSC': { 
        id: 'SSC',
        name: 'Skin Scraping', 
        price: 6000, 
        description: 'Used to diagnose fungal or parasitic skin infections.',
        category: 'Microbiology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'BG': { 
        id: 'BG',
        name: 'Blood Grouping', 
        price: 3000, 
        description: 'Determines your blood type and Rh factor.',
        category: 'Blood Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'HGBG': { 
        id: 'HGBG',
        name: 'Haemoglobin Genotype', 
        price: 5000, 
        description: 'Identifies your haemoglobin type to detect sickle cell or thalassemia traits.',
        category: 'Genetic Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'BG-HGBG': { 
        id: 'BG-HGBG',
        name: 'Blood Grouping & Genotype', 
        price: 7500, 
        description: 'Combines blood group typing and genotype testing in one package.',
        category: 'Blood Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'ASO-TITRE': { 
        id: 'ASO-TITRE',
        name: 'Antistreptolysin O Titre', 
        price: 8000, 
        description: 'Detects antibodies produced in response to Streptococcus infection.',
        category: 'Serology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'RF': { 
        id: 'RF',
        name: 'Rheumatoid Factor', 
        price: 8000, 
        description: 'Checks for rheumatoid factor antibodies that indicate autoimmune disorders.',
        category: 'Serology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'HCV': { 
        id: 'HCV',
        name: 'Hepatitis C Virus', 
        price: 5000, 
        description: 'Screens for antibodies against the Hepatitis C virus.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'VDRL': { 
        id: 'VDRL',
        name: 'Venereal Disease Research Lab', 
        price: 4000, 
        description: 'Tests for syphilis by detecting antibodies in the blood.',
        category: 'Serology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'HEP-B': { 
        id: 'HEP-B',
        name: 'Hepatitis B Virus', 
        price: 4000, 
        description: 'Detects infection with the Hepatitis B virus.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'HIV': { 
        id: 'HIV',
        name: 'Human Immunodeficiency Virus', 
        price: 4000, 
        description: 'Screens for HIV infection by detecting antibodies or antigens in the blood.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'ESR': { 
        id: 'ESR',
        name: 'Erythrocyte Sedimentation Rate', 
        price: 10000, 
        description: 'Measures how quickly red blood cells settle in a test tube to help detect inflammation in the body.',
        category: 'Blood Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'FOB': { 
        id: 'FOB',
        name: 'Faecal Occult Blood', 
        price: 4000, 
        description: 'Detects hidden blood in stool, useful in screening for gastrointestinal bleeding or colon cancer.',
        category: 'Stool Test',
        image: 'https://images.unsplash.com/photo-1581092795360-6c6f45d2f8f2?auto=format&fit=crop&w=100&q=80'
    },
    'HPYL': { 
        id: 'HPYL',
        name: 'Helicobacter Pylori Antibody Test', 
        price: 5000, 
        description: 'Detects antibodies against Helicobacter pylori, a bacteria associated with stomach ulcers.',
        category: 'Serology',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'OMT': { 
        id: 'OMT',
        name: 'Ovulation Monitoring Test', 
        price: 12000, 
        description: 'Tracks ovulation cycle through hormone levels or ultrasound imaging to assess fertility.',
        category: 'Fertility Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'HVSMCS': { 
        id: 'HVSMCS',
        name: 'High Vaginal Swab Microscopy, Culture and Sensitivity', 
        price: 8500, 
        description: 'Identifies vaginal infections and determines effective treatments through culture and sensitivity testing.',
        category: 'Microbiology',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'URMCS': { 
        id: 'URMCS',
        name: 'Urine Culture And Sensitivity', 
        price: 6500, 
        description: 'Detects bacterial infection in urine and identifies the best antibiotic treatment.',
        category: 'Urine Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'TDBIL': { 
        id: 'TDBIL',
        name: 'Total and Direct Bilirubin', 
        price: 6000, 
        description: 'Measures bilirubin levels in the blood to assess liver function and detect jaundice or liver disorders.',
        category: 'Liver Function Test',
        image: 'https://images.unsplash.com/photo-1581594549595-35f6b8a9c8b7?auto=format&fit=crop&w=100&q=80'
    },
    'BCASA': { 
        id: 'BCASA',
        name: 'Basic Computer Assisted Semen Analysis (for hospital use)', 
        price: 4000, 
        description: 'Evaluates sperm count, motility, and morphology using automated analysis systems.',
        category: 'Fertility Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'COCASA': { 
        id: 'COCASA',
        name: 'Complete Computer Assisted Semen Analysis, Culture & Sensitivity', 
        price: 18000, 
        description: 'Comprehensive semen analysis with culture and sensitivity testing for fertility and infection diagnosis.',
        category: 'Fertility Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'URCR': { 
        id: 'URCR',
        name: 'Urea Creatinine', 
        price: 12000, 
        description: 'Measures urea and creatinine levels in blood to assess kidney function.',
        category: 'Renal Function Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'SE': { 
        id: 'SE',
        name: 'Serum Electrolytes', 
        price: 9000, 
        description: 'Measures key electrolytes in the blood such as sodium, potassium, and chloride to assess fluid and acid-base balance.',
        category: 'Electrolyte Test',
        image: 'https://images.unsplash.com/photo-1581594549595-35f6b8a9c8b7?auto=format&fit=crop&w=100&q=80'
    },
    'EUC': { 
        id: 'EUC',
        name: 'Electrolyte, Urea, Creatinine', 
        price: 25000, 
        description: 'Comprehensive kidney and electrolyte profile to evaluate renal function and fluid balance.',
        category: 'Renal Function Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'LFT': { 
        id: 'LFT',
        name: 'Liver Function Test', 
        price: 16000, 
        description: 'Evaluates enzymes, proteins, and bilirubin levels to assess liver health and performance.',
        category: 'Liver Function Test',
        image: 'https://images.unsplash.com/photo-1581594549595-35f6b8a9c8b7?auto=format&fit=crop&w=100&q=80'
    },
    'LIPRO': { 
        id: 'LIPRO',
        name: 'Lipid Profile', 
        price: 18000, 
        description: 'Measures cholesterol and triglyceride levels to assess heart disease risk.',
        category: 'Cardiac Test',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'TOTCHOL': { 
        id: 'TOTCHOL',
        name: 'Total Cholesterol', 
        price: 8000, 
        description: 'Determines total cholesterol levels to monitor cardiovascular health.',
        category: 'Cardiac Test',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'STP': { 
        id: 'STP',
        name: 'Standard Thyroid Panel (T4 and TSH)', 
        price: 25000, 
        description: 'Assesses thyroid gland function by measuring T4 and TSH hormone levels.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'ETP': { 
        id: 'ETP',
        name: 'Extended Thyroid Panel (T3, T4 and TSH)', 
        price: 54000, 
        description: 'Comprehensive thyroid profile for detailed evaluation of thyroid activity and metabolism.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'HORPRO': { 
        id: 'HORPRO',
        name: 'Hormonal Profile', 
        price: 80000, 
        description: 'Full hormonal panel assessing reproductive, adrenal, and thyroid hormones for both men and women.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'RVS': { 
        id: 'RVS',
        name: 'Retroviral Screening', 
        price: 4000, 
        description: 'Screens for retroviral infections including HIV antibodies.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'TPSA': { 
        id: 'TPSA',
        name: 'Prostate Specific Antigen', 
        price: 16000, 
        description: 'Measures PSA levels to screen for prostate abnormalities and cancer.',
        category: 'Cancer Marker',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'CEA': { 
        id: 'CEA',
        name: 'Carcinoembryonic Antigen', 
        price: 14000, 
        description: 'Used to detect and monitor certain types of cancers, especially of the colon and rectum.',
        category: 'Cancer Marker',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'TREX': { 
        id: 'TREX',
        name: 'Tropical Extended', 
        price: 22500, 
        description: 'Comprehensive tropical disease panel covering major infections prevalent in tropical regions.',
        category: 'Tropical Disease Panel',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'TROBAS': { 
        id: 'TROBAS',
        name: 'Tropical Basic', 
        price: 15500, 
        description: 'Basic screening for common tropical infections and parasitic diseases.',
        category: 'Tropical Disease Panel',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'SPT': { 
        id: 'SPT',
        name: 'Serum Pregnancy Test', 
        price: 2500, 
        description: 'Detects the presence of hCG hormone in the blood to confirm pregnancy.',
        category: 'Fertility Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'ALB': { 
        id: 'ALB',
        name: 'Albumin', 
        price: 6000, 
        description: 'Measures albumin levels in the blood to evaluate liver and kidney health.',
        category: 'Liver Function Test',
        image: 'https://images.unsplash.com/photo-1581594549595-35f6b8a9c8b7?auto=format&fit=crop&w=100&q=80'
    },
    'VITD': { 
        id: 'VITD',
        name: 'Vitamin D', 
        price: 16000, 
        description: 'Determines Vitamin D levels to assess bone health and immune function.',
        category: 'Nutritional Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'CORT': { 
        id: 'CORT',
        name: 'Cortisol', 
        price: 18000, 
        description: 'Measures cortisol hormone levels to assess stress response and adrenal gland function.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'KFT': { 
        id: 'KFT',
        name: 'Kidney Function Test', 
        price: 14000, 
        description: 'Evaluates how well the kidneys are filtering waste and maintaining fluid balance.',
        category: 'Renal Function Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'MF': { 
        id: 'MF',
        name: 'Micro Filaria', 
        price: 8000, 
        description: 'Detects microfilariae in the blood, which cause filariasis and related parasitic diseases.',
        category: 'Parasitology',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'CAL': { 
        id: 'CAL',
        name: 'Calcium', 
        price: 14000, 
        description: 'Measures calcium levels in blood to assess bone health and parathyroid function.',
        category: 'Nutritional Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'PRL': { 
        id: 'PRL',
        name: 'Prolactin', 
        price: 18000, 
        description: 'Measures prolactin hormone levels to evaluate pituitary gland function and fertility issues.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'PROG': { 
        id: 'PROG',
        name: 'Progesterone', 
        price: 18000, 
        description: 'Assesses progesterone levels to monitor ovulation, fertility, and pregnancy health.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'E2': { 
        id: 'E2',
        name: 'Estradiol Hormonal Test', 
        price: 16000, 
        description: 'Measures estradiol levels to evaluate ovarian function and hormone balance.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'FSH': { 
        id: 'FSH',
        name: 'Follicle Stimulating Hormone Test', 
        price: 12000, 
        description: 'Measures FSH levels to assess fertility, menstrual cycle, and pituitary function.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'LH': { 
        id: 'LH',
        name: 'Luteinizing Hormone', 
        price: 12000, 
        description: 'Evaluates LH levels to monitor ovulation and reproductive health.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'HCV': { 
        id: 'HCV',
        name: 'Hepatitis C Virus', 
        price: 4000, 
        description: 'Screens for Hepatitis C virus antibodies to detect infection.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'Hbsag': { 
        id: 'Hbsag',
        name: 'Hepatitis B Surface Antigen', 
        price: 4000, 
        description: 'Detects the surface antigen of Hepatitis B virus, indicating active infection.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'HAV': { 
        id: 'HAV',
        name: 'Hepatitis A Virus', 
        price: 5000, 
        description: 'Detects antibodies against Hepatitis A virus to determine past or current infection.',
        category: 'Virology',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'FT4': { 
        id: 'FT4',
        name: 'Free Tetraiodothyronine', 
        price: 18000, 
        description: 'Measures the free T4 hormone level to assess thyroid gland function.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'CHLAMYD': { 
        id: 'CHLAMYD',
        name: 'Chlamydia Trachomatis Test', 
        price: 5500, 
        description: 'Detects the presence of Chlamydia trachomatis bacteria causing sexually transmitted infections.',
        category: 'Microbiology',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'RES': { 
        id: 'RES',
        name: 'Research', 
        price: 10000, 
        description: 'Special diagnostic or experimental tests performed for research and evaluation purposes.',
        category: 'Special Test',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'FPSA': { 
        id: 'FPSA',
        name: 'Free Prostate Specific Antigen', 
        price: 16000, 
        description: 'Measures the unbound PSA in the blood to aid in prostate cancer screening.',
        category: 'Cancer Marker',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'PSA_PRO': { 
        id: 'PSA_PRO',
        name: 'Complete PSA Profile', 
        price: 32000, 
        description: 'Comprehensive prostate-specific antigen profile for advanced screening of prostate health.',
        category: 'Cancer Marker',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'RBG': { 
        id: 'RBG',
        name: 'Random Blood Glucose', 
        price: 2500, 
        description: 'Measures blood glucose levels at any time of the day to screen for diabetes.',
        category: 'Glucose Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'GONOR': { 
        id: 'GONOR',
        name: 'Gonorrhea Test', 
        price: 7000, 
        description: 'Detects Neisseria gonorrhoeae bacteria responsible for gonorrhea infection.',
        category: 'Microbiology',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'FBG': { 
        id: 'FBG',
        name: 'Fasting Blood Glucose', 
        price: 2500, 
        description: 'Measures blood sugar levels after fasting to check for diabetes and glucose metabolism.',
        category: 'Glucose Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'HPYLANT': { 
        id: 'HPYLANT',
        name: 'Helicobacter Pylori Antigen Test', 
        price: 12000, 
        description: 'Detects H. pylori antigens in stool for diagnosing stomach infections.',
        category: 'Serology',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'HbA1c': { 
        id: 'HbA1c',
        name: 'Glycated Haemoglobin', 
        price: 12000, 
        description: 'Determines average blood sugar levels over the past 2–3 months for diabetes monitoring.',
        category: 'Glucose Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    },
    'FT3': { 
        id: 'FT3',
        name: 'Free Triiodothyronine', 
        price: 18000, 
        description: 'Measures the free T3 thyroid hormone to evaluate thyroid activity and metabolism.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'TSH': { 
        id: 'TSH',
        name: 'Thyroid Stimulating Hormone', 
        price: 18000, 
        description: 'Measures TSH levels to assess thyroid gland function and detect hypo- or hyperthyroidism.',
        category: 'Hormonal Test',
        image: 'https://images.unsplash.com/photo-1603360946369-dc9debb09a2d?auto=format&fit=crop&w=100&q=80'
    },
    'WOUND-SWAB-CS': { 
        id: 'WOUND-SWAB-CS',
        name: 'Wound Swab Culture and Sensitivity', 
        price: 10000, 
        description: 'Detects and identifies bacteria from wound infections and determines the most effective antibiotic treatment.',
        category: 'Microbiology',
        image: 'https://images.unsplash.com/photo-1628614538535-8a5b8d024d3f?auto=format&fit=crop&w=100&q=80'
    },
    'hs-CRP': { 
        id: 'hs-CRP',
        name: 'High Sensitivity C-reactive Protein', 
        price: 18000, 
        description: 'Measures C-reactive protein levels to detect low levels of inflammation linked to cardiovascular disease risk.',
        category: 'Inflammation Marker',
        image: 'https://images.unsplash.com/photo-1606202376960-3e94b245b23d?auto=format&fit=crop&w=100&q=80'
    },
    'RSS': { 
        id: 'RSS',
        name: 'Reprocessing Storage and Security', 
        price: 5000, 
        description: 'Administrative and processing fee covering safe handling, storage, and documentation of test samples.',
        category: 'Service Charge',
        image: 'https://images.unsplash.com/photo-1582719471384-894fbb16e074?auto=format&fit=crop&w=100&q=80'
    },
    'UR-ACID': { 
        id: 'UR-ACID',
        name: 'Uric Acid', 
        price: 18000, 
        description: 'Measures uric acid levels in the blood to help diagnose gout or monitor kidney function.',
        category: 'Renal Function Test',
        image: 'https://images.unsplash.com/photo-1603791452906-bb1b3f6c9f4e?auto=format&fit=crop&w=100&q=80'
    }
        };
        
        const systemPrompt = `You are a friendly and helpful Health AI Assistant, called Sophia. Your goal is to understand a user's health symptoms and suggest relevant medical tests from a predefined list.

You MUST follow these rules:
1.  Your responses MUST be in JSON format.
2.  Do not use markdown in the JSON response.
3.  Keep your conversational messages concise and easy to understand.
4.  Ask clarifying questions one at a time to narrow down the symptoms.
5.  When you have enough information, suggest relevant tests.
6.  The available tests are: CBC, HGB, PCV, MPT, WAT, UC, CAURM, ERYBAS, FBC, CBS, SA, SSN, SSC, BG, HGBG, BG-HGBG, ASO-TITRE, RF, HCV, VDRL, HEP-B, ESR, FOB, HPYL, OMT, HVSMCS, URMCS, TDBIL, BCASA, COCASA, URCR, SE, EUC, LFT, LIPRO, TOTCHOL, STP, ETP, HORPRO, RVS, TPSA, CEA, TREX, TROBAS, SPT, ALB, VITD, CORT, KFT, MF, CAL, PRL, PROG, E2, FSH, LH, HCV2, Hbsag, HAV, FT4, CHLAMYD,  RES, FPSA, PSA-PRO, RBG, GONOR, FBG, HPYLANT, HbA1c, FT3, TSH, WOUND-SWAB-CS, hs-CRP, RSS, UR-ACID. Only suggest tests from this list.
7.  Provide relevant quick reply options to guide the user.
8.  If the user's query is unrelated to health, politely steer the conversation back to symptoms.
9.  ALWAYS Verify Age and Gender befor recommending tests.

The JSON output must follow this exact schema:
{
  "message": "Your conversational response to the user.",
  "suggestedTests": ["TEST_CODE_1", "TEST_CODE_2", ...],
  "quickReplies": ["Option 1", "Option 2", ...]
}

Example interaction:
User: "I have a bad headache"
Your JSON response:
{
  "message": "I'm sorry to hear that. To understand better, are you feeling any nausea or sensitivity to light?",
  "suggestedTests": [],
  "quickReplies": ["Yes, I have nausea", "Yes, sensitivity to light", "Both", "Neither"]
}`;

        const addMessage = (sender, message) => {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('flex', 'mb-4', sender === 'user' ? 'justify-end' : 'justify-start');
            
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('rounded-xl', 'py-2', 'px-4', 'max-w-xs', 'lg:max-w-md', sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-bot');
            messageBubble.innerText = message;
            
            messageWrapper.appendChild(messageBubble);
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        const showTypingIndicator = () => {
             const typingWrapper = document.createElement('div');
             typingWrapper.id = 'typing-indicator';
             typingWrapper.classList.add('flex', 'mb-4', 'justify-start');
             typingWrapper.innerHTML = `<div class="loader"></div>`;
             chatContainer.appendChild(typingWrapper);
             chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        const removeTypingIndicator = () => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        };

        const updateQuickReplies = (replies = []) => {
            quickRepliesContainer.innerHTML = '';
            if (replies.length > 0) {
                replies.forEach(reply => {
                    const button = document.createElement('button');
                    button.textContent = reply;
                    button.classList.add('px-3', 'py-1', 'border', 'border-blue-500', 'text-blue-500', 'rounded-full', 'text-sm', 'hover:bg-blue-500', 'hover:text-white', 'transition');
                    button.onclick = () => handleUserInput(reply);
                    quickRepliesContainer.appendChild(button);
                });
            }
        };

        const processBotResponse = async (userInputText) => {
            conversationHistory.push({ role: "user", parts: [{ text: userInputText }] });

            try {
                const payload = {
                    contents: conversationHistory,
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                const result = await response.json();
                const botResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!botResponseText) {
                     throw new Error("Received an empty response from the API.");
                }

                const cleanedJsonString = botResponseText.replace(/```json|```/g, '').trim();
                const botResponseJson = JSON.parse(cleanedJsonString);
                
                conversationHistory.push({ role: "model", parts: [{ text: JSON.stringify(botResponseJson) }] });
                
                removeTypingIndicator();

                if (botResponseJson.message) {
                    addMessage('bot', botResponseJson.message);
                }
                if (botResponseJson.quickReplies) {
                    updateQuickReplies(botResponseJson.quickReplies);
                }
                if (botResponseJson.suggestedTests && botResponseJson.suggestedTests.length > 0) {
                    suggestTests(botResponseJson.suggestedTests);
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                removeTypingIndicator();
                addMessage('bot', "I'm having a little trouble connecting right now. Please try again in a moment.");
            }
        };
        
        const handleUserInput = (inputText) => {
            const trimmedInput = inputText.trim();
            if (trimmedInput === '') return;

            addMessage('user', trimmedInput);
            userInput.value = '';
            updateQuickReplies(); 
            showTypingIndicator();
            
            processBotResponse(trimmedInput);
        };
        
        sendBtn.addEventListener('click', () => handleUserInput(userInput.value));
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserInput(userInput.value);
            }
        });

        const suggestTests = (testCodes) => {
            const suggestedTestsContainer = document.createElement('div');
            suggestedTestsContainer.id = 'suggested-tests-container';
            suggestedTestsContainer.className = 'mt-4 p-4 bg-gray rounded-lg border border-gray-200';
            suggestedTestsContainer.innerHTML = '<h3 class="font-bold text-lg mb-3 text-white">Suggested Tests</h3>';
            
            testCodes.forEach(code => {
                const test = testDatabase[code];
                if (!test) return;

                const card = document.createElement('div');
                card.classList.add('p-4', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200', 'test-card-enter', 'mb-3', 'suggestion');
                card.innerHTML = `
                    <h3 class="font-bold text-md text-gray-800">${test.name}</h3>
                    <p class="text-sm text-gray-600 my-1">${test.description}</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-lg font-semibold text-blue-600">₦${test.price.toLocaleString()}</span>
                        <button class="add-to-cart-btn bg-blue-100 text-blue-700 px-4 py-1 rounded-md text-sm font-semibold hover:bg-blue-200 transition" data-code="${code}">Add to Cart</button>
                    </div>
                `;
                suggestedTestsContainer.appendChild(card);
            });

            chatContainer.appendChild(suggestedTestsContainer);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Add event listeners to the add to cart buttons
            document.querySelectorAll('#suggested-tests-container .add-to-cart-btn').forEach(button => {
                button.onclick = (e) => {
                    const code = e.target.dataset.code;
                    const test = testDatabase[code];
                    if (test && window.labCart) {
                        const added = window.labCart.addItem(test);
                        if (added) {
                            e.target.textContent = 'Added!';
                            e.target.disabled = true;
                            e.target.classList.remove('bg-blue-100', 'hover:bg-blue-200');
                            e.target.classList.add('bg-green-100', 'text-green-700');
                        }
                    } else {
                        console.error("Could not add item to cart. Test or labCart is missing.", { test, labCart: window.labCart });
                    }
                };
            });
        };

        // Initialize cart system when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.labCart = new CartSystem();
            
            // Initial bot message
            const initialMessage = "Hello! I'm Sophia, your personal health assistant. I can help you understand your symptoms and suggest relevant lab tests. What's your main symptom today?";
            const initialReplies = ['Headache', 'Fever', 'Stomach Pain', 'Fatigue'];
            
            conversationHistory.push({
                role: "model",
                parts: [{ text: JSON.stringify({ message: initialMessage, suggestedTests: [], quickReplies: initialReplies }) }]
            });
            addMessage('bot', initialMessage);
            updateQuickReplies(initialReplies);
        });
    </script>

</body></html>
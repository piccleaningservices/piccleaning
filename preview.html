<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minimal Shop Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

  <!-- Header -->
  <header class="flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 shadow-sm bg-white gap-3">
    <h1 class="text-2xl font-bold">üõçÔ∏è CleanShop</h1>
    <div class="flex items-center gap-3">
      <input id="search-bar" type="text" placeholder="Search products..." class="border rounded-xl px-3 py-1 focus:outline-none focus:ring focus:ring-gray-300">
      <div id="cart-btn" class="relative cursor-pointer">
        <span class="material-icons">shopping_cart</span>
        <span id="cart-count" class="absolute -top-2 -right-2 bg-black text-white text-xs rounded-full px-2 py-0.5">0</span>
      </div>
    </div>
  </header>

  <!-- Category Filters -->
  <div id="categories" class="flex flex-wrap gap-2 p-4 justify-center">
    <button onclick="filterCategory('All', this)" class="category-btn px-4 py-1 rounded-full bg-black text-white">All</button>
    <button onclick="filterCategory('Electronics', this)" class="category-btn px-4 py-1 rounded-full bg-gray-200 text-gray-700">Electronics</button>
    <button onclick="filterCategory('Clothing', this)" class="category-btn px-4 py-1 rounded-full bg-gray-200 text-gray-700">Clothing</button>
    <button onclick="filterCategory('Books', this)" class="category-btn px-4 py-1 rounded-full bg-gray-200 text-gray-700">Books</button>
  </div>

  <!-- Product Grid -->
  <main id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 p-8"></main>

  <!-- Pagination -->
  <div id="pagination" class="flex justify-center gap-2 mt-6 mb-10"></div>

  <!-- Overlay for closing drawer -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden"></div>

  <!-- Cart Drawer -->
  <aside id="cart-drawer" class="fixed top-0 right-0 w-80 h-full bg-white shadow-lg transform translate-x-full transition-transform p-4 flex flex-col z-50">
    <h2 class="text-xl font-bold mb-4">Your Cart</h2>
    <ul id="cart-items" class="flex-1 space-y-2 overflow-y-auto"></ul>
    <div class="mt-4 border-t pt-2">
      <p class="font-semibold">Total: ‚Ç¶<span id="cart-total">0</span></p>
      <button onclick="checkout()" class="w-full mt-3 bg-green-600 text-white py-2 rounded-xl hover:bg-green-700 transition">Checkout on WhatsApp</button>
    </div>
  </aside>

  <!-- Subtle sound -->
  <audio id="cart-sound" preload="auto">
    <source src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" type="audio/ogg">
    <source src="https://actions.google.com/sounds/v1/cartoon/pop.mp3" type="audio/mpeg">
  </audio>

  <script>
    const products = Array.from({length: 100}).map((_, i) => ({
      name: `Product ${i+1}`,
      price: (i+1) * 500,
      category: i % 3 === 0 ? 'Electronics' : i % 3 === 1 ? 'Clothing' : 'Books',
      image: 'https://via.placeholder.com/200x100'
    }));

    const cart = [];
    const cartSound = document.getElementById('cart-sound');

    let currentPage = 1;
    const itemsPerPage = 12;
    let currentCategory = 'All';

    function filterCategory(category, button) {
      currentCategory = category;
      document.getElementById('search-bar').value = '';
      currentPage = 1;
      renderProducts();

      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('bg-black', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      button.classList.remove('bg-gray-200', 'text-gray-700');
      button.classList.add('bg-black', 'text-white');
    }

    function renderProducts(filter = '') {
      const grid = document.getElementById('product-grid');
      grid.innerHTML = '';

      const filteredProducts = products
        .filter(p => currentCategory === 'All' || p.category === currentCategory)
        .filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginated = filteredProducts.slice(start, end);

      paginated.forEach((p, i) => {
        const div = document.createElement('div');
        const categoryBadge = `<span class="absolute top-3 left-3 bg-gray-800 text-white text-xs font-semibold px-2 py-0.5 rounded-full">${p.category}</span>`;

        div.className = 'bg-white shadow-md rounded-2xl p-6 flex flex-col items-center transition transform hover:scale-105 relative animate-fadeIn';
        div.innerHTML = `
          ${categoryBadge}
          <div class="w-full h-52 flex items-center justify-center mb-4 pt-4">
            <img src="${p.image}" alt="${p.name}" class="rounded-xl object-contain h-full">
          </div>
          <h2 class="font-semibold text-lg">${p.name}</h2>
          <p class="text-gray-600">‚Ç¶${p.price.toLocaleString()}</p>
          <button onclick="addToCart('${p.name}', ${p.price}, '${p.image}', ${i})" class="mt-3 bg-black text-white px-4 py-2 rounded-xl hover:bg-gray-800 transition">Add to Cart</button>
          <a href="product.html?name=${encodeURIComponent(p.name)}" class="mt-3 bg-gray-200 text-black px-4 py-2 rounded-xl text-center hover:bg-gray-300 transition">View Details</a>
        `;
        grid.appendChild(div);
      });

      renderPagination(filteredProducts.length);
    }

    function renderPagination(totalItems) {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      const totalPages = Math.ceil(totalItems / itemsPerPage);

      if (totalPages <= 1) return;

      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'Prev';
      prevBtn.disabled = currentPage === 1;
      prevBtn.className = 'px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50';
      prevBtn.onclick = () => { currentPage--; renderProducts(document.getElementById('search-bar').value); window.scrollTo({top:0, behavior:'smooth'}); };
      pagination.appendChild(prevBtn);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i===currentPage ? 'bg-black text-white' : 'bg-gray-200 hover:bg-gray-300'}`;
        btn.onclick = () => { currentPage = i; renderProducts(document.getElementById('search-bar').value); window.scrollTo({top:0, behavior:'smooth'}); };
        pagination.appendChild(btn);
      }

      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'Next';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.className = 'px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50';
      nextBtn.onclick = () => { currentPage++; renderProducts(document.getElementById('search-bar').value); window.scrollTo({top:0, behavior:'smooth'}); };
      pagination.appendChild(nextBtn);
    }

    function addToCart(name, price, image, index) {
      const existing = cart.find(item => item.name === name);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ name, price, qty: 1 });
      }
      updateCart();
      playCartFeedback();
      flyToCart(index);
    }

    function playCartFeedback() {
      cartSound.currentTime = 0;
      cartSound.play();
      const cartCount = document.getElementById('cart-count');
      cartCount.classList.add('scale-125');
      setTimeout(() => cartCount.classList.remove('scale-125'), 200);
    }

    function flyToCart(index) {
      const productCards = document.querySelectorAll('#product-grid > div');
      const card = productCards[index];
      if (!card) return;
      const img = card.querySelector('img');
      const cartBtn = document.getElementById('cart-btn');

      const imgClone = img.cloneNode(true);
      const rect = img.getBoundingClientRect();
      imgClone.style.position = 'fixed';
      imgClone.style.left = rect.left + 'px';
      imgClone.style.top = rect.top + 'px';
      imgClone.style.width = rect.width + 'px';
      imgClone.style.height = rect.height + 'px';
      imgClone.style.zIndex = 1000;
      imgClone.style.transition = 'all 0.7s ease-in-out';
      document.body.appendChild(imgClone);

      const cartRect = cartBtn.getBoundingClientRect();
      setTimeout(() => {
        imgClone.style.left = cartRect.left + 'px';
        imgClone.style.top = cartRect.top + 'px';
        imgClone.style.width = '30px';
        imgClone.style.height = '30px';
        imgClone.style.opacity = '0.5';
      }, 50);

      setTimeout(() => imgClone.remove(), 750);
    }

    function updateCart() {
      const cartItems = document.getElementById('cart-items');
      const cartCount = document.getElementById('cart-count');
      const cartTotal = document.getElementById('cart-total');
      
      cartItems.innerHTML = '';
      let total = 0, count = 0;

      cart.forEach((item, index) => {
        total += item.price * item.qty;
        count += item.qty;

        const li = document.createElement('li');
        li.className = 'flex justify-between items-center animate-fadeIn';
        li.innerHTML = `
          <div>
            <span class="font-medium">${item.name}</span><br>
            <span class="text-sm text-gray-500">‚Ç¶${item.price.toLocaleString()}</span>
          </div>
          <div class="flex items-center space-x-2">
            <button onclick="changeQty(${index}, -1)" class="px-2 bg-gray-200 rounded">-</button>
            <span>${item.qty}</span>
            <button onclick="changeQty(${index}, 1)" class="px-2 bg-gray-200 rounded">+</button>
            <button onclick="removeItem(${index})" class="text-red-500">‚úï</button>
          </div>
        `;
        cartItems.appendChild(li);
      });

      cartTotal.textContent = total.toLocaleString();
      cartCount.textContent = count;
    }

    function changeQty(index, delta) {
      cart[index].qty += delta;
      if (cart[index].qty <= 0) cart.splice(index, 1);
      updateCart();
    }

    function removeItem(index) {
      cart.splice(index, 1);
      updateCart();
    }

    // Toggle cart drawer
    const cartBtn = document.getElementById('cart-btn');
    const cartDrawer = document.getElementById('cart-drawer');
    const overlay = document.getElementById('overlay');

    cartBtn.addEventListener('click', () => {
      cartDrawer.classList.remove('translate-x-full');
      overlay.classList.remove('hidden');
    });

    overlay.addEventListener('click', () => {
      cartDrawer.classList.add('translate-x-full');
      overlay.classList.add('hidden');
    });

    function checkout() {
      if (cart.length === 0) return alert('Cart is empty');

      let message = 'üõçÔ∏è New Order:%0A';
      let total = 0;
      cart.forEach(item => {
        message += `‚Ä¢ ${item.name} (x${item.qty}) - ‚Ç¶${(item.price * item.qty).toLocaleString()}%0A`;
        total += item.price * item.qty;
      });
      message += `%0ATotal: ‚Ç¶${total.toLocaleString()}%0APlease confirm my order ‚úÖ`;

      const phone = '2348163645085';
      const url = /Mobi|Android/i.test(navigator.userAgent)
        ? `https://api.whatsapp.com/send?phone=${phone}&text=${message}`
        : `https://web.whatsapp.com/send?phone=${phone}&text=${message}`;

      window.open(url, '_blank');
    }

    document.getElementById('search-bar').addEventListener('input', (e) => {
      currentPage = 1;
      renderProducts(e.target.value);
    });

    // Add custom fadeIn animation
    const style = document.createElement('style');
    style.innerHTML = `
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fadeIn { animation: fadeIn 0.4s ease-in-out; }
    `;
    document.head.appendChild(style);

    renderProducts();
  </script>

  <!-- Material icons for cart -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</body>
</html>